function checkFormCompletion(){const e=document.getElementById("provinsi").value,t=document.getElementById("kabupaten").value,n=document.getElementById("kecamatan").value,a=document.getElementById("kelurahan").value,r=document.getElementById("korcam").value,s=document.getElementById("korlu").value,o=e&&t&&n&&a&&r&&s;dataRelawan.kelurahan=document.getElementById("kelurahan").value,document.getElementById("nextButton").disabled=!o}function showNextStep(e){1===e?(document.getElementById("form-step-1").classList.add("hidden"),document.getElementById("form-step-2").classList.remove("hidden"),document.getElementById("step-1-indicator").classList.remove("text-blue-600"),document.getElementById("step-2-indicator").classList.add("text-blue-600")):2===e&&(document.getElementById("form-step-2").classList.add("hidden"),document.getElementById("form-step-3").classList.remove("hidden"),document.getElementById("step-2-indicator").classList.remove("text-blue-600"),document.getElementById("step-3-indicator").classList.add("text-blue-600"),document.getElementById("registerUser").innerHTML=`\n      <span class="text-green-600 text-xl font-semibold">Username anda: ${formDataRelawan.user}</span>\n      `,document.getElementById("registerPassword").innerHTML=`\n      <span class="text-green-600 text-xl font-semibold">Password anda: ${formDataRelawan.password}</span>\n      `)}function showPreviousStep(e){2===e?(document.getElementById("form-step-2").classList.add("hidden"),document.getElementById("formData").classList.add("hidden"),document.getElementById("form-step-1").classList.remove("hidden"),document.getElementById("step-2-indicator").classList.remove("text-blue-600"),document.getElementById("step-1-indicator").classList.add("text-blue-600")):3===e&&(document.getElementById("form-step-3").classList.add("hidden"),document.getElementById("form-step-2").classList.remove("hidden"),document.getElementById("step-3-indicator").classList.remove("text-blue-600"),document.getElementById("step-2-indicator").classList.add("text-blue-600"))}function resetResult(){document.getElementById("formData").innerHTML="",document.getElementById("pemilih").innerHTML="",document.getElementById("konfirmasiData").innerHTML="",document.getElementById("errorData").innerHTML="",document.getElementById("errorAtas").innerHTML="",document.getElementById("successData").innerHTML=""}function clearError(){document.getElementById("errorData").innerHTML="",document.getElementById("errorAtas").innerHTML=""}async function validasiNik(e){resetResult();const t=await apiRequest.apiGet("/validasi",{nik:e});if(t.success)return t.data;resetResult(),showError(t.error)}function showError(e){document.getElementById("errorData").innerHTML=`\n    <div class="m-4 p-4 bg-red-50">\n    <span>${e}</span>\n    </div>`}function showSuccess(e){document.getElementById("successData").innerHTML=`\n  <div class="m-4 p-4 bg-green-50">\n  <span>${e}</span>\n  </div>`}function showErrorAtas(e){document.getElementById("errorAtas").innerHTML=`\n  <div class="m-4 p-4 bg-red-50">\n  <span>${e}</span>\n  </div>`}function populateTps(e,t,n="Pilih"){e.innerHTML=`<option value="">${n}</option>`,t.forEach((t=>{e.innerHTML+=`<option value="${t.id}">${t.namaTps}</option>`}))}async function validasiUserName(e){return!!(await apiRequest.apiGet("/validasi-user",{username:e})).success}function populateKorTps(e,t,n){formDataRelawan.fkPemilih=parseInt(e),formDataRelawan.nama=t,formDataRelawan.fkRelawanLvl2=parseInt(document.getElementById("korlu").value),formDataRelawan.verifikasi=0,formDataRelawan.status=1,formDataRelawan.alamat=n,formDataRelawan.kelurahan=document.getElementById("kelurahan").value;JSON.stringify(formDataRelawan);document.getElementById("pemilih").innerHTML="",document.getElementById("konfirmasiData").innerHTML=`\n  <div class="flex flex-col gap-4 m-4 p-4 bg-orange-50">\n    <div class="font-semibold">Konfirmasi Data:</div>\n    <ul class="list-disc pl-5">\n      <li>Nama : ${formDataRelawan.nama}</li>\n      <li>Alamat : ${formDataRelawan.alamat}</li>\n    </ul>\n    <div class=col-span-2>\n        <label for="noHp" class="block text-sm font-medium text-gray-700">No WA / HP</label>\n        <input type="text" id="noHp" name="noHp" placeholder="No HP/WA yang bisa dihubungi" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2.5" required />\n    </div>\n    <div class="col-span-2">\n        <label for="tpsPenugasan" class="block text-sm font-medium text-gray-700">TPS Penugasan</label>\n        <select id="tpsPenugasan" name="tpsPenugasan" class="bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 block w-full p-2.5">\n         <option value="">Pilih Tps</option>\n        </select>\n    </div>\n    <div class=col-span-2>\n        <label for="username" class="block text-sm font-medium text-gray-700">Username</label>\n        <input type="text" id="username" name="username" placeholder="username" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2.5" required />\n        <div class="mt-2 p-2" id="errorUser" name="errorUser""></div>\n    </div>\n    <div class=col-span-2>\n        <label for="password" class="block text-sm font-medium text-gray-700">Password</label>\n        <input type="password" id="password" name="password" placeholder="minimal 5-8 digit password" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2.5" required />\n        <div class="mt-2 p-2" id="errorPassword" name="errorPassword""></div>\n    </div>\n    <button type="button" id="kirimBtn" onclick="simpanRelawan()" class="mt-4 inline-flex justify-center text-white bg-orange-600 hover:bg-orange-700 focus:ring-4 focus:outline-none focus:ring-orage-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center dark:bg-orange-600 dark:hover:bg-orange-700 dark:focus:ring-orange-800">\n      Kirim\n    </button>\n  </div>\n`;const a=document.getElementById("tpsPenugasan");fetch(`${apiUrl}/tps?kelurahan=${formDataRelawan.kelurahan}`).then((e=>e.json())).then((e=>{populateTps(a,e.data,"Pilih Tps Penugasan"),a.disabled=!1}))}function validateFormRelawan(e){for(const t in e)if(e.hasOwnProperty(t)){const n=e[t];if(""===n||Number.isNaN(n))return showErrorAtas(`Mohon isi: ${t}`),!1}return clearError(),!0}async function simpanRelawan(){const e=document.getElementById("tpsPenugasan").value,t=document.getElementById("username");let n=t.value;n=n.toLowerCase().replace(/\s+/g,""),t.value=n,formDataRelawan.user=t.value,formDataRelawan.password=document.getElementById("password").value,formDataRelawan.fkTps=parseInt(e),formDataRelawan.noHp=document.getElementById("noHp").value;if(!await validasiUserName(formDataRelawan.user))return void(document.getElementById("errorUser").innerHTML=`\n       <span class="mt-2 text-red-600" >Username ${formDataRelawan.user} telah digunakan, silahkan coba Username yg lain</span>\n      `);if(document.getElementById("errorUser").innerHTML="",formDataRelawan.password.length<6||formDataRelawan.password.length>9)return void(document.getElementById("errorPassword").innerHTML='\n       <span class="mt-2 text-red-600" >Password minimal 5 dan maksimal 8 digit</span>\n      ');document.getElementById("errorUser").innerHTML="";if(validateFormRelawan(formDataRelawan)){const e=await apiRequest.apiPost("/relawan-lv3",formDataRelawan);resetResult(),e.success?showNextStep(2):showError(e.error)}}function simpanDataRelawan(e){"string"==typeof e&&JSON.parse(e);const t=JSON.stringify(e);fetch(`${apiUrl}/relawan-lv3`,{method:"POST",headers:{"Content-Type":"application/json"},body:t}).then((e=>e.json())).then((e=>{e.success?(resetResult(),showNextStep(2)):(resetResult(),showError(e.error),showPreviousStep(1))})).catch((e=>{resetResult(),showError(e),showPreviousStep(1)}))}async function isiTpsPemilih(e,t){const n=await apiRequest.apiGet("/tps",{kelurahan:t});n.success?(populateTps(e,n.data,"Pilih TPS Pemilih"),e.disabled=!1):(populateTps(e,[],"Pilih TPS Pemilih"),e.disabled=!0)}async function openConfirmationPage(e){updatePemilih=await validasiNik(e);const t=updatePemilih.pemilih;resetResult(),populateKorTps(t[0].id,t[0].nama,t[0].alamatKtp)}document.getElementById("formNik").addEventListener("submit",(async function(e){e.preventDefault();const t=document.getElementById("nik").value;try{const e=await validasiNik(t),n=e.pemilih;if(dataRelawan.noKtp=t,e.status_nik){n[0].id,n[0].nama,n[0].tps,n[0].namaTps;document.getElementById("pemilih").innerHTML=`\n<div class="relative overflow-x-auto">\n    <table class="w-full text-sm text-left rtl:text-right text-gray-500">\n        <thead class="text-xs text-gray-700 uppercase bg-gray-50">\n            <tr>\n                <th scope="col" class="px-6 py-3">\n                    Nama\n                </th>\n                <th scope="col" class="px-6 py-3">\n                    Alamat\n                </th>\n            </tr>\n        </thead>\n        <tbody>\n            <tr class="bg-white border-b dark:bg-gray-800 dark:border-gray-700">\n                <th scope="row" class="px-6 py-4 font-small text-gray-900 whitespace-nowrap dark:text-white">\n                    ${n[0].nama}\n                </th>\n                <td class="px-6 py-4">\n                    ${n[0].alamatKtp}\n                </td>\n            </tr>\n        </tbody>\n    </table>\n    <div class="mt-2 flex justify-center items-center">\n     <button type="button" id="pilihPemilihBtn" onclick="populateKorTps('${n[0].id}', \`${n[0].nama}\`, '${n[0].alamatKtp.replace(/'/g,"\\'")}')" class="flex justify-items-center text-white bg-orange-600 hover:bg-orange-800 focus:ring-4 focus:outline-none focus:ring-orange-300 font-medium rounded-lg text-sm px-5 py-2.5 text-center inline-flex items-center">\n        Pilih\n        <svg class="rtl:rotate-180 w-3.5 h-3.5 ms-2" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 14 10">\n            <path stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M1 5h12m0 0L9 1m4 4L9 9"/>\n        </svg>\n    </button>\n    </div>\n</div>    \n    `}else{document.getElementById("formData").classList.remove("hidden"),document.getElementById("formData").innerHTML=`\n        <form id="formDataDiri" class="max-w-xl mx-auto grid grid-cols-1 gap-4 sm:grid-cols-2">\n        <div>\n          <label for="noKtp" class="block text-sm font-medium text-gray-700">NIK</label>\n          <input type="text" id="noKtp" name="noKtp" value="${t}" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2.5"/>\n        </div>\n        <div>\n          <label for="nama" class="block text-sm font-medium text-gray-700">Nama</label>\n          <input type="text" id="nama" name="nama" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2.5" required />\n        </div>\n        <div>\n          <label for="fkTpsKtp" class="block text-sm font-medium text-gray-700">TPS</label>\n          <select id="fkTpsKtp" name="fkTpsKtp" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2.5">\n            <option value="">Pilih TPS</option>\n          </select>\n        </div>\n        <div>\n          <label for="tempatLahir" class="block text-sm font-medium text-gray-700">Tempat Lahir</label>\n          <input type="text" id="tempatLahir" name="tempatLahir" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2.5" required />\n        </div>\n        \n        <div>\n          <label for="noHp" class="block text-sm font-medium text-gray-700">No HP/WA</label>\n          <input type="tel" id="noHp" name="noHp" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2.5" required />\n        </div>\n    \n        <div class="sm:col-span-2">\n          <label for="alamatKtp" class="block text-sm font-medium text-gray-700">Alamat</label>\n          <input type="text" id="alamatKtp" name="alamatKtp" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2.5" required />\n        </div>\n    \n        <div>\n          <label for="fileKtp" class="block text-sm font-medium text-gray-700">Foto KTP</label>\n          <input type="file" id="fileKtp" name="fileKtp" accept="image/*" class="w-full bg-gray-50 border border-gray-300 text-gray-900 text-sm rounded-lg focus:ring-blue-500 focus:border-blue-500 p-2.5" required />\n        </div>\n    \n        <div class="sm:col-span-2 flex justify-between mt-4">\n          \x3c!-- Back Button --\x3e\n          <button type="button" onclick="showPreviousStep(2)" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-gray-600 hover:bg-gray-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-gray-500">\n            Kembali\n          </button>\n    \n          \x3c!-- Submit Button --\x3e\n          <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent shadow-sm text-sm font-medium rounded-md text-white bg-green-600 hover:bg-green-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-green-500">\n            Kirim\n          </button>\n        </div>\n    \n      </form>\n        `;const e=document.getElementById("fkTpsKtp"),n=dataRelawan.kelurahan;isiTpsPemilih(e,n),document.getElementById("formDataDiri").addEventListener("submit",(function(e){e.preventDefault();const t=new FormData(this);t.append("fkKelurahanDomisili",n),async function(e){try{const t=await fetch(`${apiUrl}/pemilih`,{method:"POST",body:e}),n=await t.json();if(n.success)return void openConfirmationPage(dataRelawan.noKtp);resetResult(),showError(n.error)}catch(e){showError("Gagal input data pemilih, periksa NIK")}}(t)}))}}catch(e){console.log("Error : ",e)}}));